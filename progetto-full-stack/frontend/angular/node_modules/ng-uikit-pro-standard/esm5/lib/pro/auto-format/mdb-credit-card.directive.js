import { __decorate, __metadata } from "tslib";
import { Directive, HostListener, Input, HostBinding } from '@angular/core';
import * as ɵngcc0 from '@angular/core';
var MdbCreditCardDirective = /** @class */ (function () {
    function MdbCreditCardDirective() {
        this.standardPattern = /(\d{1,4})/g;
        this.defaultCard = {
            name: '',
            fullName: '',
            re: /\d{0,16}/,
            pattern: this.standardPattern,
            maxLength: 19,
            cvvLength: 3,
        };
        this.cards = [
            {
                name: 'visa',
                fullName: 'Visa',
                re: /^4\d{0,15}/,
                pattern: this.standardPattern,
                maxLength: 16,
                cvvLength: 3,
            },
            {
                name: 'mastercard',
                fullName: 'Mastercard',
                re: /^(5[1-5]\d{0,2}|22[2-9]\d{0,1}|2[3-7]\d{0,2})\d{0,12}/,
                pattern: this.standardPattern,
                maxLength: 16,
                cvvLength: 3,
            },
            {
                name: 'amex',
                fullName: 'American Express',
                re: /^3[47]\d{0,13}/,
                pattern: /(\d{1,4})(\d{1,6})?(\d{1,5})?/,
                maxLength: 15,
                cvvLength: 4,
            },
            {
                name: 'jcb',
                fullName: 'JCB',
                re: /^(?:35\d{0,2})\d{0,12}/,
                pattern: this.standardPattern,
                maxLength: 16,
                cvvLength: 3,
            },
            {
                name: 'discover',
                fullName: 'Discover',
                re: /^(?:6011|65\d{0,2}|64[4-9]\d?)\d{0,12}/,
                pattern: this.standardPattern,
                maxLength: 16,
                cvvLength: 3,
            },
            {
                name: 'diners-club',
                fullName: 'Diners Club',
                re: /^3(?:0([0-5]|9)|[689]\d?)\d{0,11}/,
                pattern: this.standardPattern,
                maxLength: 14,
                cvvLength: 3,
            },
        ];
        this._separator = ' ';
    }
    Object.defineProperty(MdbCreditCardDirective.prototype, "additionalCards", {
        get: function () {
            return this._additionalCards;
        },
        set: function (cards) {
            this._additionalCards = cards;
            this.addCards(cards);
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(MdbCreditCardDirective.prototype, "separator", {
        get: function () {
            return this._separator;
        },
        set: function (separator) {
            this._separator = separator;
        },
        enumerable: true,
        configurable: true
    });
    MdbCreditCardDirective.prototype.onInput = function (event) {
        this.formatInput(event);
    };
    MdbCreditCardDirective.prototype.formatInput = function (event) {
        var input = event.target.value;
        var formattedInput = this.getFormattedInput(input);
        event.target.value = formattedInput;
    };
    MdbCreditCardDirective.prototype.getFormattedInput = function (value) {
        value = this.removeNonDigits(value);
        var card = this.findCardByNumber(value);
        this.updateCurrentCardNames(card.name, card.fullName);
        var cardNumMaxLength;
        if (this.hasStandardPattern(card)) {
            var matches = value.match(card.pattern);
            if (matches === null) {
                return value;
            }
            cardNumMaxLength = card.maxLength + matches.length - 1;
            this.maxLength = cardNumMaxLength.toString();
            return matches.join(this.separator);
        }
        else {
            var results = card.pattern.exec(value);
            if (results === null) {
                return value;
            }
            results.shift();
            cardNumMaxLength = card.maxLength + results.length - 1;
            this.maxLength = cardNumMaxLength.toString();
            return results.filter(this.isMatch).join(this.separator);
        }
    };
    MdbCreditCardDirective.prototype.removeNonDigits = function (value) {
        return value.replace(/\D/g, '');
    };
    MdbCreditCardDirective.prototype.hasStandardPattern = function (card) {
        return card.pattern.toString() === this.standardPattern.toString();
    };
    MdbCreditCardDirective.prototype.isMatch = function (match) {
        return match !== undefined;
    };
    MdbCreditCardDirective.prototype.updateCurrentCardNames = function (name, fullName) {
        this.cardName = name;
        this.cardFullName = fullName;
    };
    MdbCreditCardDirective.prototype.findCardByNumber = function (value) {
        var cardType = this.cards.find(function (card) {
            return card.re.test(value);
        });
        if (!cardType) {
            return this.defaultCard;
        }
        return cardType;
    };
    MdbCreditCardDirective.prototype.addCards = function (newCards) {
        var _this = this;
        newCards.forEach(function (card) {
            _this.cards.push(card);
        });
    };
    __decorate([
        Input(),
        __metadata("design:type", Array),
        __metadata("design:paramtypes", [Array])
    ], MdbCreditCardDirective.prototype, "additionalCards", null);
    __decorate([
        Input(),
        __metadata("design:type", String),
        __metadata("design:paramtypes", [String])
    ], MdbCreditCardDirective.prototype, "separator", null);
    __decorate([
        HostBinding('attr.maxLength'),
        __metadata("design:type", String)
    ], MdbCreditCardDirective.prototype, "maxLength", void 0);
    __decorate([
        HostListener('input', ['$event']),
        __metadata("design:type", Function),
        __metadata("design:paramtypes", [Object]),
        __metadata("design:returntype", void 0)
    ], MdbCreditCardDirective.prototype, "onInput", null);
    MdbCreditCardDirective = __decorate([ __metadata("design:paramtypes", [])
    ], MdbCreditCardDirective);
MdbCreditCardDirective.ɵfac = function MdbCreditCardDirective_Factory(t) { return new (t || MdbCreditCardDirective)(); };
MdbCreditCardDirective.ɵdir = ɵngcc0.ɵɵdefineDirective({ type: MdbCreditCardDirective, selectors: [["", "mdbCreditCard", ""]], hostVars: 1, hostBindings: function MdbCreditCardDirective_HostBindings(rf, ctx) { if (rf & 1) {
        ɵngcc0.ɵɵlistener("input", function MdbCreditCardDirective_input_HostBindingHandler($event) { return ctx.onInput($event); });
    } if (rf & 2) {
        ɵngcc0.ɵɵattribute("maxLength", ctx.maxLength);
    } }, inputs: { additionalCards: "additionalCards", separator: "separator" }, exportAs: ["mdbCreditCard"] });
/*@__PURE__*/ (function () { ɵngcc0.ɵsetClassMetadata(MdbCreditCardDirective, [{
        type: Directive,
        args: [{
                selector: '[mdbCreditCard]',
                exportAs: 'mdbCreditCard'
            }]
    }], function () { return []; }, { additionalCards: [{
            type: Input
        }], separator: [{
            type: Input
        }], onInput: [{
            type: HostListener,
            args: ['input', ['$event']]
        }], maxLength: [{
            type: HostBinding,
            args: ['attr.maxLength']
        }] }); })();
    return MdbCreditCardDirective;
}());
export { MdbCreditCardDirective };
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibWRiLWNyZWRpdC1jYXJkLmRpcmVjdGl2ZS5qcyIsInNvdXJjZXMiOlsibmctdWlraXQtcHJvLXN0YW5kYXJkL2xpYi9wcm8vYXV0by1mb3JtYXQvbWRiLWNyZWRpdC1jYXJkLmRpcmVjdGl2ZS50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiO0FBQUEsT0FBTyxFQUFFLFNBQVMsRUFBRSxZQUFZLEVBQUUsS0FBSyxFQUFFLFdBQVcsRUFBRSxNQUFNLGVBQWUsQ0FBQzs7QUFlNUU7QUFDcUIsSUFtRm5CO0FBRWlCLFFBckZULG9CQUFlLEdBQUcsWUFBWSxDQUFDO0FBQ3hDLFFBR1MsZ0JBQVcsR0FBZTtBQUNuQyxZQUFHLElBQUksRUFBRSxFQUFFO0FBQ1gsWUFBRyxRQUFRLEVBQUUsRUFBRTtBQUNmLFlBQUcsRUFBRSxFQUFFLFVBQVU7QUFDakIsWUFBRyxPQUFPLEVBQUUsSUFBSSxDQUFDLGVBQWU7QUFDaEMsWUFBRyxTQUFTLEVBQUUsRUFBRTtBQUNoQixZQUFHLFNBQVMsRUFBRSxDQUFDO0FBQ2YsU0FBRSxDQUFDO0FBRUosUUFBVSxVQUFLLEdBQWlCO0FBQy9CLFlBQUc7QUFDSCxnQkFBSyxJQUFJLEVBQUUsTUFBTTtBQUNqQixnQkFBSyxRQUFRLEVBQUUsTUFBTTtBQUNyQixnQkFBSyxFQUFFLEVBQUUsWUFBWTtBQUNyQixnQkFBSyxPQUFPLEVBQUUsSUFBSSxDQUFDLGVBQWU7QUFDbEMsZ0JBQUssU0FBUyxFQUFFLEVBQUU7QUFDbEIsZ0JBQUssU0FBUyxFQUFFLENBQUM7QUFDakIsYUFBSTtBQUNKLFlBQUc7QUFDSCxnQkFBSyxJQUFJLEVBQUUsWUFBWTtBQUN2QixnQkFBSyxRQUFRLEVBQUUsWUFBWTtBQUMzQixnQkFBSyxFQUFFLEVBQUUsdURBQXVEO0FBQ2hFLGdCQUFLLE9BQU8sRUFBRSxJQUFJLENBQUMsZUFBZTtBQUNsQyxnQkFBSyxTQUFTLEVBQUUsRUFBRTtBQUNsQixnQkFBSyxTQUFTLEVBQUUsQ0FBQztBQUNqQixhQUFJO0FBQ0osWUFBRztBQUNILGdCQUFLLElBQUksRUFBRSxNQUFNO0FBQ2pCLGdCQUFLLFFBQVEsRUFBRSxrQkFBa0I7QUFDakMsZ0JBQUssRUFBRSxFQUFFLGdCQUFnQjtBQUN6QixnQkFBSyxPQUFPLEVBQUUsK0JBQStCO0FBQzdDLGdCQUFLLFNBQVMsRUFBRSxFQUFFO0FBQ2xCLGdCQUFLLFNBQVMsRUFBRSxDQUFDO0FBQ2pCLGFBQUk7QUFDSixZQUFHO0FBQ0gsZ0JBQUssSUFBSSxFQUFFLEtBQUs7QUFDaEIsZ0JBQUssUUFBUSxFQUFFLEtBQUs7QUFDcEIsZ0JBQUssRUFBRSxFQUFFLHdCQUF3QjtBQUNqQyxnQkFBSyxPQUFPLEVBQUUsSUFBSSxDQUFDLGVBQWU7QUFDbEMsZ0JBQUssU0FBUyxFQUFFLEVBQUU7QUFDbEIsZ0JBQUssU0FBUyxFQUFFLENBQUM7QUFDakIsYUFBSTtBQUNKLFlBQUc7QUFDSCxnQkFBSyxJQUFJLEVBQUUsVUFBVTtBQUNyQixnQkFBSyxRQUFRLEVBQUUsVUFBVTtBQUN6QixnQkFBSyxFQUFFLEVBQUUsd0NBQXdDO0FBQ2pELGdCQUFLLE9BQU8sRUFBRSxJQUFJLENBQUMsZUFBZTtBQUNsQyxnQkFBSyxTQUFTLEVBQUUsRUFBRTtBQUNsQixnQkFBSyxTQUFTLEVBQUUsQ0FBQztBQUNqQixhQUFJO0FBQ0osWUFBRztBQUNILGdCQUFLLElBQUksRUFBRSxhQUFhO0FBQ3hCLGdCQUFLLFFBQVEsRUFBRSxhQUFhO0FBQzVCLGdCQUFLLEVBQUUsRUFBRSxtQ0FBbUM7QUFDNUMsZ0JBQUssT0FBTyxFQUFFLElBQUksQ0FBQyxlQUFlO0FBQ2xDLGdCQUFLLFNBQVMsRUFBRSxFQUFFO0FBQ2xCLGdCQUFLLFNBQVMsRUFBRSxDQUFDO0FBQ2pCLGFBQUk7QUFDSixTQUFFLENBQUM7QUFFSixRQWlCVSxlQUFVLEdBQUcsR0FBRyxDQUFDO0FBRTNCLElBQWlCLENBQUM7QUFFbEIsSUFwQkUsc0JBQUksbURBQWU7QUFDckIsYUFERTtBQUFlLFlBQ2IsT0FBTyxJQUFJLENBQUMsZ0JBQWdCLENBQUM7QUFDaEMsUUFBQyxDQUFDO0FBQ0QsYUFBQSxVQUFvQixLQUFtQjtBQUN4QyxZQUFHLElBQUksQ0FBQyxnQkFBZ0IsR0FBRyxLQUFLLENBQUM7QUFDakMsWUFBRyxJQUFJLENBQUMsUUFBUSxDQUFDLEtBQUssQ0FBQyxDQUFDO0FBQ3hCLFFBQUMsQ0FBQztBQUNEO0FBQTJCO0FBRzFCLE9BUkE7QUFDRixJQU9DLHNCQUFJLDZDQUFTO0FBQ2YsYUFERTtBQUFlLFlBQ2IsT0FBTyxJQUFJLENBQUMsVUFBVSxDQUFDO0FBQzFCLFFBQUMsQ0FBQztBQUNELGFBQUEsVUFBYyxTQUFpQjtBQUNoQyxZQUFHLElBQUksQ0FBQyxVQUFVLEdBQUcsU0FBUyxDQUFDO0FBQy9CLFFBQUMsQ0FBQztBQUNEO0FBRUY7QUFFUSxPQVJMO0FBQ0YsSUFVQyx3Q0FBTyxHQUFQLFVBQVEsS0FBVTtBQUNuQixRQUFHLElBQUksQ0FBQyxXQUFXLENBQUMsS0FBSyxDQUFDLENBQUM7QUFDM0IsSUFBQyxDQUFDO0FBRUYsSUFBUyw0Q0FBVyxHQUFuQixVQUFvQixLQUFVO0FBQy9CLFFBQUcsSUFBTSxLQUFLLEdBQUcsS0FBSyxDQUFDLE1BQU0sQ0FBQyxLQUFLLENBQUM7QUFDcEMsUUFBRyxJQUFNLGNBQWMsR0FBRyxJQUFJLENBQUMsaUJBQWlCLENBQUMsS0FBSyxDQUFDLENBQUM7QUFDeEQsUUFBRyxLQUFLLENBQUMsTUFBTSxDQUFDLEtBQUssR0FBRyxjQUFjLENBQUM7QUFDdkMsSUFBQyxDQUFDO0FBRUYsSUFBUyxrREFBaUIsR0FBekIsVUFBMEIsS0FBYTtBQUN4QyxRQUFHLEtBQUssR0FBRyxJQUFJLENBQUMsZUFBZSxDQUFDLEtBQUssQ0FBQyxDQUFDO0FBQ3ZDLFFBQUcsSUFBTSxJQUFJLEdBQUcsSUFBSSxDQUFDLGdCQUFnQixDQUFDLEtBQUssQ0FBQyxDQUFDO0FBRTlDLFFBQUksSUFBSSxDQUFDLHNCQUFzQixDQUFDLElBQUksQ0FBQyxJQUFJLEVBQUUsSUFBSSxDQUFDLFFBQVEsQ0FBQyxDQUFDO0FBRTFELFFBQUksSUFBSSxnQkFBd0IsQ0FBQztBQUVqQyxRQUFJLElBQUksSUFBSSxDQUFDLGtCQUFrQixDQUFDLElBQUksQ0FBQyxFQUFFO0FBQ3RDLFlBQUssSUFBTSxPQUFPLEdBQTRCLEtBQUssQ0FBQyxLQUFLLENBQUMsSUFBSSxDQUFDLE9BQU8sQ0FBQyxDQUFDO0FBRXpFLFlBQU0sSUFBSSxPQUFPLEtBQUssSUFBSSxFQUFFO0FBQzNCLGdCQUFPLE9BQU8sS0FBSyxDQUFDO0FBQ3BCLGFBQU07QUFFUCxZQUFNLGdCQUFnQixHQUFHLElBQUksQ0FBQyxTQUFTLEdBQUcsT0FBTyxDQUFDLE1BQU0sR0FBRyxDQUFDLENBQUM7QUFDNUQsWUFBSyxJQUFJLENBQUMsU0FBUyxHQUFHLGdCQUFnQixDQUFDLFFBQVEsRUFBRSxDQUFDO0FBQ2xELFlBQUssT0FBTyxPQUFPLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxTQUFTLENBQUMsQ0FBQztBQUN6QyxTQUFJO0FBQUUsYUFBSTtBQUNWLFlBQUssSUFBTSxPQUFPLEdBQTJCLElBQUksQ0FBQyxPQUFPLENBQUMsSUFBSSxDQUFDLEtBQUssQ0FBQyxDQUFDO0FBRXZFLFlBQU0sSUFBSSxPQUFPLEtBQUssSUFBSSxFQUFFO0FBQzNCLGdCQUFPLE9BQU8sS0FBSyxDQUFDO0FBQ3BCLGFBQU07QUFDTixZQUFLLE9BQU8sQ0FBQyxLQUFLLEVBQUUsQ0FBQztBQUNyQixZQUFLLGdCQUFnQixHQUFHLElBQUksQ0FBQyxTQUFTLEdBQUcsT0FBTyxDQUFDLE1BQU0sR0FBRyxDQUFDLENBQUM7QUFDNUQsWUFBSyxJQUFJLENBQUMsU0FBUyxHQUFHLGdCQUFnQixDQUFDLFFBQVEsRUFBRSxDQUFDO0FBQ2xELFlBQUssT0FBTyxPQUFPLENBQUMsTUFBTSxDQUFDLElBQUksQ0FBQyxPQUFPLENBQUMsQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLFNBQVMsQ0FBQyxDQUFDO0FBQzlELFNBQUk7QUFDSixJQUFDLENBQUM7QUFFRixJQUFTLGdEQUFlLEdBQXZCLFVBQXdCLEtBQWE7QUFDdEMsUUFBRyxPQUFPLEtBQUssQ0FBQyxPQUFPLENBQUMsS0FBSyxFQUFFLEVBQUUsQ0FBQyxDQUFDO0FBQ25DLElBQUMsQ0FBQztBQUVGLElBQVMsbURBQWtCLEdBQTFCLFVBQTJCLElBQWdCO0FBQzVDLFFBQUcsT0FBTyxJQUFJLENBQUMsT0FBTyxDQUFDLFFBQVEsRUFBRSxLQUFLLElBQUksQ0FBQyxlQUFlLENBQUMsUUFBUSxFQUFFLENBQUM7QUFDdEUsSUFBQyxDQUFDO0FBRUYsSUFBUyx3Q0FBTyxHQUFmLFVBQWdCLEtBQWE7QUFDOUIsUUFBRyxPQUFPLEtBQUssS0FBSyxTQUFTLENBQUM7QUFDOUIsSUFBQyxDQUFDO0FBRUYsSUFBUyx1REFBc0IsR0FBOUIsVUFBK0IsSUFBWSxFQUFFLFFBQWdCO0FBQzlELFFBQUcsSUFBSSxDQUFDLFFBQVEsR0FBRyxJQUFJLENBQUM7QUFDeEIsUUFBRyxJQUFJLENBQUMsWUFBWSxHQUFHLFFBQVEsQ0FBQztBQUNoQyxJQUFDLENBQUM7QUFFRixJQUFTLGlEQUFnQixHQUF4QixVQUF5QixLQUFhO0FBQ3ZDLFFBQUcsSUFBTSxRQUFRLEdBQUcsSUFBSSxDQUFDLEtBQUssQ0FBQyxJQUFJLENBQUMsVUFBQSxJQUFJO0FBQUssWUFDeEMsT0FBTyxJQUFJLENBQUMsRUFBRSxDQUFDLElBQUksQ0FBQyxLQUFLLENBQUMsQ0FBQztBQUNoQyxRQUFHLENBQUMsQ0FBQyxDQUFDO0FBRVAsUUFBSSxJQUFJLENBQUMsUUFBUSxFQUFFO0FBQ2xCLFlBQUssT0FBTyxJQUFJLENBQUMsV0FBVyxDQUFDO0FBQzdCLFNBQUk7QUFFTCxRQUFJLE9BQU8sUUFBUSxDQUFDO0FBQ25CLElBQUMsQ0FBQztBQUVGLElBQVEseUNBQVEsR0FBZixVQUFnQixRQUFzQjtBQUN2QyxRQURDLGlCQUlDO0FBQ0YsUUFKRyxRQUFRLENBQUMsT0FBTyxDQUFDLFVBQUEsSUFBSTtBQUFLLFlBQ3hCLEtBQUksQ0FBQyxLQUFLLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxDQUFDO0FBQzNCLFFBQUcsQ0FBQyxDQUFDLENBQUM7QUFDTixJQUFDLENBQUM7QUFFSCxJQW5HRTtBQUFjLFFBRGIsS0FBSyxFQUFFO0FBQ1I7QUFDaUI7QUFFWSxpRUFENUI7QUFDRCxJQU9BO0FBQWMsUUFEYixLQUFLLEVBQUU7QUFDUjtBQUN3QjtBQUdsQiwyREFGTDtBQUNELElBTytCO0FBQWMsUUFBNUMsV0FBVyxDQUFDLGdCQUFnQixDQUFDO0FBQUc7QUFFViw2REFGMEI7QUFFbEQsSUFDQztBQUFjLFFBRGIsWUFBWSxDQUFDLE9BQU8sRUFBRSxDQUFDLFFBQVEsQ0FBQyxDQUFDO0FBQ2xDO0FBQ3NCO0FBSWxCO0FBQ1cseURBSmQ7QUFFRixJQTdGWSxzQkFBc0IseUJBSmxDLFNBQVMsQ0FBQyxlQUNULG5DQUdPO0tBSEMsRUFBRSxpQkFBaUIseEJBSXBCLE9BREksc0JBQXNCLENBb0tsQztPQXRLQyxRQUFRLEVBQUUsZUFBZSxZQUMxQixDQUFDOzs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7O29CQXNLRjtBQUFFLElBREYsNkJBQUM7QUFDQyxDQURELEFBcEtELElBb0tDOztBQW5MQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBZUEsQUFvRkEsQUFuRkEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUlBLEFBQUEsQUFBQSxBQUNBLEFBQUEsQUFBQSxBQUFBLEFBQ0EsQUFBQSxBQUFBLEFBQUEsQUFDQSxBQUFBLEFBQUEsQUFBQSxBQUNBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUNBLEFBQUEsQUFBQSxBQUFBLEFBQ0EsQUFBQSxBQUFBLEFBQUEsQUFDQSxBQUFBLEFBRUEsQUFBQSxBQUFBLEFBQ0EsQUFDQSxBQUFBLEFBQUEsQUFBQSxBQUNBLEFBQUEsQUFBQSxBQUFBLEFBQ0EsQUFBQSxBQUFBLEFBQUEsQUFDQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFDQSxBQUFBLEFBQUEsQUFBQSxBQUNBLEFBQUEsQUFBQSxBQUFBLEFBQ0EsQUFDQSxBQUNBLEFBQUEsQUFBQSxBQUFBLEFBQ0EsQUFBQSxBQUFBLEFBQUEsQUFDQSxBQUFBLEFBQUEsQUFBQSxBQUNBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUNBLEFBQUEsQUFBQSxBQUFBLEFBQ0EsQUFBQSxBQUFBLEFBQUEsQUFDQSxBQUNBLEFBQ0EsQUFBQSxBQUFBLEFBQUEsQUFDQSxBQUFBLEFBQUEsQUFBQSxBQUNBLEFBQUEsQUFBQSxBQUFBLEFBQ0EsQUFBQSxBQUFBLEFBQUEsQUFDQSxBQUFBLEFBQUEsQUFBQSxBQUNBLEFBQUEsQUFBQSxBQUFBLEFBQ0EsQUFDQSxBQUNBLEFBQUEsQUFBQSxBQUFBLEFBQ0EsQUFBQSxBQUFBLEFBQUEsQUFDQSxBQUFBLEFBQUEsQUFBQSxBQUNBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUNBLEFBQUEsQUFBQSxBQUFBLEFBQ0EsQUFBQSxBQUFBLEFBQUEsQUFDQSxBQUNBLEFBQ0EsQUFBQSxBQUFBLEFBQUEsQUFDQSxBQUFBLEFBQUEsQUFBQSxBQUNBLEFBQUEsQUFBQSxBQUFBLEFBQ0EsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQ0EsQUFBQSxBQUFBLEFBQUEsQUFDQSxBQUFBLEFBQUEsQUFBQSxBQUNBLEFBQ0EsQUFDQSxBQUFBLEFBQUEsQUFBQSxBQUNBLEFBQUEsQUFBQSxBQUFBLEFBQ0EsQUFBQSxBQUFBLEFBQUEsQUFDQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFDQSxBQUFBLEFBQUEsQUFBQSxBQUNBLEFBQUEsQUFBQSxBQUFBLEFBQ0EsQUFDQSxBQUFBLEFBbUJBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFFQSxBQUFBLEFBbEJBLEFBQUEsQUFBQSxBQUFBLEFBQ0EsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQ0EsQUFBQSxBQUNBLEFBQUEsQUFBQSxBQUNBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQ0EsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUNBLEFBQUEsQUFKQSxBQVFBLEFBQUEsQUFBQSxBQUFBLEFBQ0EsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQ0EsQUFBQSxBQUNBLEFBQUEsQUFBQSxBQUNBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQ0EsQUFBQSxBQUhBLEFBV0EsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUNBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFDQSxBQUFBLEFBRUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUNBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQ0EsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUNBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUNBLEFBQUEsQUFFQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQ0EsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFDQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBRUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUVBLEFBQUEsQUFBQSxBQUFBLEFBRUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQ0EsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFFQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFDQSxBQUFBLEFBQUEsQUFBQSxBQUNBLEFBRUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFDQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUNBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFDQSxBQUFBLEFBQ0EsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFFQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFDQSxBQUFBLEFBQUEsQUFBQSxBQUNBLEFBQ0EsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQ0EsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFDQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUNBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUNBLEFBQ0EsQUFBQSxBQUVBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFDQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQ0EsQUFBQSxBQUVBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFDQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUNBLEFBQUEsQUFFQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQ0EsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQ0EsQUFBQSxBQUVBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQ0EsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFDQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUNBLEFBQUEsQUFFQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQ0EsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQ0EsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUNBLEFBQUEsQUFBQSxBQUFBLEFBRUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUNBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUNBLEFBRUEsQUFBQSxBQUFBLEFBQUEsQUFDQSxBQUFBLEFBRUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBSUEsQUFIQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUNBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQ0EsQUFBQSxBQUFBLEFBQUEsQUFDQSxBQUFBLEFBakdBLEFBREEsQUFBQSxBQUFBLEFBR0EsQUFRQSxBQURBLEFBQUEsQUFBQSxBQUdBLEFBUUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFHQSxBQURBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUdBLEFBM0ZBLEFBQUEsQUFKQSxBQUFBLEFBQUEsQUFDQSxBQUFBLEFBQUEsQUFBQSxBQUNBLEFBQUEsQUFBQSxBQUFBLEFBQ0EsQUFBQSxBQUNBLEFBQUEsQUFvS0EsQUFBQSxBQUFBLEFBQUEsQUFwS0EsQUFvS0EsQUFwS0EsQUFBQSIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IERpcmVjdGl2ZSwgSG9zdExpc3RlbmVyLCBJbnB1dCwgSG9zdEJpbmRpbmcgfSBmcm9tICdAYW5ndWxhci9jb3JlJztcblxuZXhwb3J0IGludGVyZmFjZSBDcmVkaXRDYXJkIHtcbiAgbmFtZTogc3RyaW5nO1xuICBmdWxsTmFtZTogc3RyaW5nO1xuICByZTogUmVnRXhwO1xuICBwYXR0ZXJuOiBSZWdFeHA7XG4gIG1heExlbmd0aDogbnVtYmVyO1xuICBjdnZMZW5ndGg6IG51bWJlcjtcbn1cblxuQERpcmVjdGl2ZSh7XG4gIHNlbGVjdG9yOiAnW21kYkNyZWRpdENhcmRdJyxcbiAgZXhwb3J0QXM6ICdtZGJDcmVkaXRDYXJkJyxcbn0pXG5leHBvcnQgY2xhc3MgTWRiQ3JlZGl0Q2FyZERpcmVjdGl2ZSB7XG4gIHByaXZhdGUgc3RhbmRhcmRQYXR0ZXJuID0gLyhcXGR7MSw0fSkvZztcbiAgY2FyZE5hbWU6IHN0cmluZztcbiAgY2FyZEZ1bGxOYW1lOiBzdHJpbmc7XG5cbiAgcHJpdmF0ZSBkZWZhdWx0Q2FyZDogQ3JlZGl0Q2FyZCA9IHtcbiAgICBuYW1lOiAnJyxcbiAgICBmdWxsTmFtZTogJycsXG4gICAgcmU6IC9cXGR7MCwxNn0vLFxuICAgIHBhdHRlcm46IHRoaXMuc3RhbmRhcmRQYXR0ZXJuLFxuICAgIG1heExlbmd0aDogMTksXG4gICAgY3Z2TGVuZ3RoOiAzLFxuICB9O1xuXG4gIHByaXZhdGUgY2FyZHM6IENyZWRpdENhcmRbXSA9IFtcbiAgICB7XG4gICAgICBuYW1lOiAndmlzYScsXG4gICAgICBmdWxsTmFtZTogJ1Zpc2EnLFxuICAgICAgcmU6IC9eNFxcZHswLDE1fS8sXG4gICAgICBwYXR0ZXJuOiB0aGlzLnN0YW5kYXJkUGF0dGVybixcbiAgICAgIG1heExlbmd0aDogMTYsXG4gICAgICBjdnZMZW5ndGg6IDMsXG4gICAgfSxcbiAgICB7XG4gICAgICBuYW1lOiAnbWFzdGVyY2FyZCcsXG4gICAgICBmdWxsTmFtZTogJ01hc3RlcmNhcmQnLFxuICAgICAgcmU6IC9eKDVbMS01XVxcZHswLDJ9fDIyWzItOV1cXGR7MCwxfXwyWzMtN11cXGR7MCwyfSlcXGR7MCwxMn0vLFxuICAgICAgcGF0dGVybjogdGhpcy5zdGFuZGFyZFBhdHRlcm4sXG4gICAgICBtYXhMZW5ndGg6IDE2LFxuICAgICAgY3Z2TGVuZ3RoOiAzLFxuICAgIH0sXG4gICAge1xuICAgICAgbmFtZTogJ2FtZXgnLFxuICAgICAgZnVsbE5hbWU6ICdBbWVyaWNhbiBFeHByZXNzJyxcbiAgICAgIHJlOiAvXjNbNDddXFxkezAsMTN9LyxcbiAgICAgIHBhdHRlcm46IC8oXFxkezEsNH0pKFxcZHsxLDZ9KT8oXFxkezEsNX0pPy8sXG4gICAgICBtYXhMZW5ndGg6IDE1LFxuICAgICAgY3Z2TGVuZ3RoOiA0LFxuICAgIH0sXG4gICAge1xuICAgICAgbmFtZTogJ2pjYicsXG4gICAgICBmdWxsTmFtZTogJ0pDQicsXG4gICAgICByZTogL14oPzozNVxcZHswLDJ9KVxcZHswLDEyfS8sXG4gICAgICBwYXR0ZXJuOiB0aGlzLnN0YW5kYXJkUGF0dGVybixcbiAgICAgIG1heExlbmd0aDogMTYsXG4gICAgICBjdnZMZW5ndGg6IDMsXG4gICAgfSxcbiAgICB7XG4gICAgICBuYW1lOiAnZGlzY292ZXInLFxuICAgICAgZnVsbE5hbWU6ICdEaXNjb3ZlcicsXG4gICAgICByZTogL14oPzo2MDExfDY1XFxkezAsMn18NjRbNC05XVxcZD8pXFxkezAsMTJ9LyxcbiAgICAgIHBhdHRlcm46IHRoaXMuc3RhbmRhcmRQYXR0ZXJuLFxuICAgICAgbWF4TGVuZ3RoOiAxNixcbiAgICAgIGN2dkxlbmd0aDogMyxcbiAgICB9LFxuICAgIHtcbiAgICAgIG5hbWU6ICdkaW5lcnMtY2x1YicsXG4gICAgICBmdWxsTmFtZTogJ0RpbmVycyBDbHViJyxcbiAgICAgIHJlOiAvXjMoPzowKFswLTVdfDkpfFs2ODldXFxkPylcXGR7MCwxMX0vLFxuICAgICAgcGF0dGVybjogdGhpcy5zdGFuZGFyZFBhdHRlcm4sXG4gICAgICBtYXhMZW5ndGg6IDE0LFxuICAgICAgY3Z2TGVuZ3RoOiAzLFxuICAgIH0sXG4gIF07XG5cbiAgQElucHV0KClcbiAgZ2V0IGFkZGl0aW9uYWxDYXJkcygpIHtcbiAgICByZXR1cm4gdGhpcy5fYWRkaXRpb25hbENhcmRzO1xuICB9XG4gIHNldCBhZGRpdGlvbmFsQ2FyZHMoY2FyZHM6IENyZWRpdENhcmRbXSkge1xuICAgIHRoaXMuX2FkZGl0aW9uYWxDYXJkcyA9IGNhcmRzO1xuICAgIHRoaXMuYWRkQ2FyZHMoY2FyZHMpO1xuICB9XG4gIHByaXZhdGUgX2FkZGl0aW9uYWxDYXJkczogQ3JlZGl0Q2FyZFtdO1xuXG4gIEBJbnB1dCgpXG4gIGdldCBzZXBhcmF0b3IoKSB7XG4gICAgcmV0dXJuIHRoaXMuX3NlcGFyYXRvcjtcbiAgfVxuICBzZXQgc2VwYXJhdG9yKHNlcGFyYXRvcjogc3RyaW5nKSB7XG4gICAgdGhpcy5fc2VwYXJhdG9yID0gc2VwYXJhdG9yO1xuICB9XG4gIHByaXZhdGUgX3NlcGFyYXRvciA9ICcgJztcblxuICBjb25zdHJ1Y3RvcigpIHt9XG5cbiAgQEhvc3RCaW5kaW5nKCdhdHRyLm1heExlbmd0aCcpIG1heExlbmd0aDogc3RyaW5nO1xuXG4gIEBIb3N0TGlzdGVuZXIoJ2lucHV0JywgWyckZXZlbnQnXSlcbiAgb25JbnB1dChldmVudDogYW55KSB7XG4gICAgdGhpcy5mb3JtYXRJbnB1dChldmVudCk7XG4gIH1cblxuICBwcml2YXRlIGZvcm1hdElucHV0KGV2ZW50OiBhbnkpIHtcbiAgICBjb25zdCBpbnB1dCA9IGV2ZW50LnRhcmdldC52YWx1ZTtcbiAgICBjb25zdCBmb3JtYXR0ZWRJbnB1dCA9IHRoaXMuZ2V0Rm9ybWF0dGVkSW5wdXQoaW5wdXQpO1xuICAgIGV2ZW50LnRhcmdldC52YWx1ZSA9IGZvcm1hdHRlZElucHV0O1xuICB9XG5cbiAgcHJpdmF0ZSBnZXRGb3JtYXR0ZWRJbnB1dCh2YWx1ZTogc3RyaW5nKSB7XG4gICAgdmFsdWUgPSB0aGlzLnJlbW92ZU5vbkRpZ2l0cyh2YWx1ZSk7XG4gICAgY29uc3QgY2FyZCA9IHRoaXMuZmluZENhcmRCeU51bWJlcih2YWx1ZSk7XG5cbiAgICB0aGlzLnVwZGF0ZUN1cnJlbnRDYXJkTmFtZXMoY2FyZC5uYW1lLCBjYXJkLmZ1bGxOYW1lKTtcblxuICAgIGxldCBjYXJkTnVtTWF4TGVuZ3RoOiBudW1iZXI7XG5cbiAgICBpZiAodGhpcy5oYXNTdGFuZGFyZFBhdHRlcm4oY2FyZCkpIHtcbiAgICAgIGNvbnN0IG1hdGNoZXM6IFJlZ0V4cE1hdGNoQXJyYXkgfCBudWxsID0gdmFsdWUubWF0Y2goY2FyZC5wYXR0ZXJuKTtcblxuICAgICAgaWYgKG1hdGNoZXMgPT09IG51bGwpIHtcbiAgICAgICAgcmV0dXJuIHZhbHVlO1xuICAgICAgfVxuXG4gICAgICBjYXJkTnVtTWF4TGVuZ3RoID0gY2FyZC5tYXhMZW5ndGggKyBtYXRjaGVzLmxlbmd0aCAtIDE7XG4gICAgICB0aGlzLm1heExlbmd0aCA9IGNhcmROdW1NYXhMZW5ndGgudG9TdHJpbmcoKTtcbiAgICAgIHJldHVybiBtYXRjaGVzLmpvaW4odGhpcy5zZXBhcmF0b3IpO1xuICAgIH0gZWxzZSB7XG4gICAgICBjb25zdCByZXN1bHRzOiBSZWdFeHBFeGVjQXJyYXkgfCBudWxsID0gY2FyZC5wYXR0ZXJuLmV4ZWModmFsdWUpO1xuXG4gICAgICBpZiAocmVzdWx0cyA9PT0gbnVsbCkge1xuICAgICAgICByZXR1cm4gdmFsdWU7XG4gICAgICB9XG4gICAgICByZXN1bHRzLnNoaWZ0KCk7XG4gICAgICBjYXJkTnVtTWF4TGVuZ3RoID0gY2FyZC5tYXhMZW5ndGggKyByZXN1bHRzLmxlbmd0aCAtIDE7XG4gICAgICB0aGlzLm1heExlbmd0aCA9IGNhcmROdW1NYXhMZW5ndGgudG9TdHJpbmcoKTtcbiAgICAgIHJldHVybiByZXN1bHRzLmZpbHRlcih0aGlzLmlzTWF0Y2gpLmpvaW4odGhpcy5zZXBhcmF0b3IpO1xuICAgIH1cbiAgfVxuXG4gIHByaXZhdGUgcmVtb3ZlTm9uRGlnaXRzKHZhbHVlOiBzdHJpbmcpIHtcbiAgICByZXR1cm4gdmFsdWUucmVwbGFjZSgvXFxEL2csICcnKTtcbiAgfVxuXG4gIHByaXZhdGUgaGFzU3RhbmRhcmRQYXR0ZXJuKGNhcmQ6IENyZWRpdENhcmQpIHtcbiAgICByZXR1cm4gY2FyZC5wYXR0ZXJuLnRvU3RyaW5nKCkgPT09IHRoaXMuc3RhbmRhcmRQYXR0ZXJuLnRvU3RyaW5nKCk7XG4gIH1cblxuICBwcml2YXRlIGlzTWF0Y2gobWF0Y2g6IHN0cmluZykge1xuICAgIHJldHVybiBtYXRjaCAhPT0gdW5kZWZpbmVkO1xuICB9XG5cbiAgcHJpdmF0ZSB1cGRhdGVDdXJyZW50Q2FyZE5hbWVzKG5hbWU6IHN0cmluZywgZnVsbE5hbWU6IHN0cmluZykge1xuICAgIHRoaXMuY2FyZE5hbWUgPSBuYW1lO1xuICAgIHRoaXMuY2FyZEZ1bGxOYW1lID0gZnVsbE5hbWU7XG4gIH1cblxuICBwcml2YXRlIGZpbmRDYXJkQnlOdW1iZXIodmFsdWU6IHN0cmluZykge1xuICAgIGNvbnN0IGNhcmRUeXBlID0gdGhpcy5jYXJkcy5maW5kKGNhcmQgPT4ge1xuICAgICAgcmV0dXJuIGNhcmQucmUudGVzdCh2YWx1ZSk7XG4gICAgfSk7XG5cbiAgICBpZiAoIWNhcmRUeXBlKSB7XG4gICAgICByZXR1cm4gdGhpcy5kZWZhdWx0Q2FyZDtcbiAgICB9XG5cbiAgICByZXR1cm4gY2FyZFR5cGU7XG4gIH1cblxuICBwdWJsaWMgYWRkQ2FyZHMobmV3Q2FyZHM6IENyZWRpdENhcmRbXSkge1xuICAgIG5ld0NhcmRzLmZvckVhY2goY2FyZCA9PiB7XG4gICAgICB0aGlzLmNhcmRzLnB1c2goY2FyZCk7XG4gICAgfSk7XG4gIH1cbn1cbiJdfQ==